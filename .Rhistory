values_to = "rel_abund",
names_prefix = "week_",
names_transform = as.numeric)
df2$site <-
df2 %>%
separate(site, into=c("location","site")) %>%
pivot_longer(starts_with("week"),
names_to = "week",
values_to = "rel_abund",
names_prefix = "week_",
names_transform = as.numeric)
df2 <-
df2 %>%
separate(site, into=c("location","site")) %>%
pivot_longer(starts_with("week"),
names_to = "week",
values_to = "rel_abund",
names_prefix = "week_",
names_transform = as.numeric)
df2
df2 %>%
mutate(location = case_when(location == "SewagePool" ~ "SEP",
location == "Hatchery" ~ "HAT"))
?qt()
qt(0.95, df = 199)
tStar = qt((1 - .95)/2, 200 - 1)
qt(0.95, 199)
library(tidyverse)
library(janitor)
library(readxl)
path <- "./Data/Messy_bp.xlsx"
df <- rad_xlsx(path)
df <- read_xlsx(path)
df <- read_xlsx(path, range = "A4:M24")
visits <- read_xlsx(path, skipt = 2,n_max = 1)
visits <- read_xlsx(path, skip = 2,n_max = 1)
visits <- read_xlsx(path, skip = 2,n_max = 0)
names(visits)
View(df)
# the data starts lower so we're not going to see column names
# data starts on A4 and ends on M24
# range lets you fix what is shown
df <- read_xlsx(path, range = "A4:M24") %>% clean_names()
df %>% pivot_longer(starts_with("bp_")
df %>% pivot_longer(starts_with("bp_"))
df %>% pivot_longer(starts_with("bp_"))
# we want to pivot all the blood pressures together
df %>% pivot_longer(starts_with("bp_")) %>%
mutate(visit = case_when(name == "bp_8" ~ 1))
View(df)
# we want to pivot all the blood pressures together
df %>% pivot_longer(starts_with("bp_")) %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3))
# we want to pivot all the blood pressures together
df <-
df %>% pivot_longer(starts_with("bp_")) %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3))
View(df)
# we want to pivot all the blood pressures together
df <-
df %>% pivot_longer(starts_with("bp_")) %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
pivot_longer(starts_with("hr_"),
names_to = "visit2",
values_to = "heart_rate")
# we want to pivot all the blood pressures together
df <-
df %>% pivot_longer(starts_with("bp_")) %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
pivot_longer(starts_with("hr_"),
names_to = "visit2",
values_to = "heart_rate")
df %>% pivot_longer(starts_with("bp_")) %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
pivot_longer(starts_with("hr_"),
names_to = "visit2",
values_to = "heart_rate")
df <-
df %>% pivot_longer(starts_with("bp_")) %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
pivot_longer(starts_with("hr_"),
names_to = "visit2",
values_to = "heart_rate")
# we want to pivot all the blood pressures together
df <-
df %>% pivot_longer(starts_with("bp_"), values_to = "bp") %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
pivot_longer(starts_with("hr_"),
names_to = "visit2",
values_to = "heart_rate")
# we want to pivot all the blood pressures together
df <-
df %>% pivot_longer(starts_with("bp_"), values_to = "bp") %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
pivot_longer(starts_with("hr_"),
names_to = "visit2",
values_to = "heart_rate")
# we want to pivot all the blood pressures together
df <-
df %>% pivot_longer(starts_with("bp_"), values_to = "bp") %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
pivot_longer(starts_with("hr_"),
names_to = "visit2",
values_to = "heart_rate")
# we want to pivot all the blood pressures together
df <-
df %>% pivot_longer(starts_with("bp_"), values_to = "bp") %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3))
path <- "./Data/Messy_bp.xlsx"
# the data starts lower so we're not going to see column names
# data starts on A4 and ends on M24
# range lets you fix what is shown
df <- read_xlsx(path, range = "A4:M24") %>% clean_names()
# this can be used later to get the names of the visits
visits <- read_xlsx(path, skip = 2,n_max = 0) %>% names()
df %>%
select(-starts_with("hr_")) # for picking columns
df %>%
select(-starts_with("hr_")) %>% # for picking columns
# keeping everything except the heart rate ones
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3))
df %>%
select(-starts_with("hr_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("bp_"), values_to ="bp") %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3))
df %>%
select(-starts_with("hr_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("bp_"), values_to ="bp") %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
select(-name) %>%
separate(bp, into = c("systolic","diastolic"))
bp <-
df %>%
select(-starts_with("hr_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("bp_"), values_to ="bp") %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
select(-name) %>%
separate(bp, into = c("systolic","diastolic"))
bp <-
df %>%
select(-starts_with("hr_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("bp_"), values_to ="bp") %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
select(-name) %>%
separate(bp, into = c("systolic","diastolic"), convert = TRUE)
df %>%
select(-starts_with("bp_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("hr_"), values_to ="hr") %>%
mutate(visit = case_when(name == "bp_9" ~ 1,
name == "bp_11" ~ 2,
name == "bp_13" ~ 3))
df %>%
select(-starts_with("bp_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("hr_"), values_to ="hr") %>%
mutate(visit = case_when(name == "hr_9" ~ 1,
name == "hr_11" ~ 2,
name == "hr_13" ~ 3))
df %>%
select(-starts_with("bp_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("hr_"), values_to ="hr") %>%
mutate(visit = case_when(name == "hr_9" ~ 1,
name == "hr_11" ~ 2,
name == "hr_13" ~ 3)) %>%
select(-name)
# now join the two data frames
full_join(bp,hr)
hr <-
df %>%
select(-starts_with("bp_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("hr_"), values_to ="hr") %>%
mutate(visit = case_when(name == "hr_9" ~ 1,
name == "hr_11" ~ 2,
name == "hr_13" ~ 3)) %>%
select(-name)
# now join the two data frames
full_join(bp,hr)
# now join the two data frames
dat <-
full_join(bp,hr)
View(dat)
# add a date data type column *referene posix ct -> y-m-d
dat %>%
mutate(birthdate = paste(year_birth, month_of_birth, day_birth, separate = "-") %>% as.POSIXct())
# add a date data type column *referene posix ct -> y-m-d
dat %>%
mutate(birthdate = paste(year_birth, month_of_birth, day_birth, sep = "-") %>%
as.POSIXct())
# add a date data type column *referene posix ct -> y-m-d
dat <-
dat %>%
mutate(birthdate = paste(year_birth, month_of_birth, day_birth, sep = "-") %>%
as.POSIXct())
saveRDS()
saveRDS(dat,"./notes/cleaned.bp.rds")
readRDS("./notes/cleaded_bp.rds")
readRDS("./notes/cleaned_bp.rds")
readRDS("./notes/cleaned.bp.rds")
saveRDS(dat,"./notes/cleaned_bp.rds")
library(tidyverse)
library(janitor)
library(readxl)
path <- "./Data/Messy_bp.xlsx"
# the data starts lower so we're not going to see column names
# data starts on A4 and ends on M24
# range lets you fix what is shown
df <- read_xlsx(path, range = "A4:M24") %>% clean_names()
# this can be used later to get the names of the visits
# visits <- read_xlsx(path, skip = 2,n_max = 0) %>% names()
# we want to pivot all the blood pressures together
# df <-
# df %>% pivot_longer(starts_with("bp_"), values_to =) %>%
#   mutate(visit = case_when(name == "bp_8" ~ 1,
#                            name == "bp_10" ~ 2,
#                            name == "bp_12" ~ 3)) %>%
#   pivot_longer(starts_with("hr_"),
#                names_to = "visit2",
#                values_to = "heart_rate")
# make a data frame with just the bp values
bp <-
df %>%
select(-starts_with("hr_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("bp_"), values_to ="bp") %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
select(-name) %>%
separate(bp, into = c("systolic","diastolic"), convert = TRUE)
# make data frame with just the hr values
hr <-
df %>%
select(-starts_with("bp_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("hr_"), values_to ="hr") %>%
mutate(visit = case_when(name == "hr_9" ~ 1,
name == "hr_11" ~ 2,
name == "hr_13" ~ 3)) %>%
select(-name)
# now join the two data frames
dat <-
full_join(bp,hr)
# add a date data type column *referene posix ct -> y-m-d
dat <-
dat %>%
mutate(birthdate = paste(year_birth,
month_of_birth,
day_birth,
sep = "-") %>%
as.POSIXct())
saveRDS(dat,"./notes/cleaned_bp.rds")
dat <- readRDS("./notes/cleaned_bp.rds")
names(dat)
library(GGally)
dat %>%
ggpairs()
ggpairs()
# part of (GGally), gets an initial look at the data
dat %>%
select(-c(pat_id, month_of_birth, day_birth, year_birth)) %>%
ggpairs()
dat %>%
ggplot(aes(x=visit,color=hispanic)) +
geom_path(aes(y=systolic),color="black") +
geom_path(aes(y=diastolic),color="black")
dat %>%
ggplot(aes(x=visit,linetype=hispanic)) +
geom_path(aes(y=systolic),color="black") +
geom_path(aes(y=diastolic),color="black")
dat %>%
ggplot(aes(x=visit)) +
geom_path(aes(y=systolic),color="black") +
geom_path(aes(y=diastolic),color="black")
dat %>%
ggplot(aes(x=visit)) +
geom_path(aes(y=systolic),color="red") +
geom_path(aes(y=diastolic),color="black")
dat %>%
ggplot(aes(x=visit)) +
geom_path(aes(y=systolic),color="red") +
geom_path(aes(y=diastolic),color="black") +
facet_wrap(~hispanic)
dat %>%
ggplot(aes(x=visit)) +
geom_point(aes(y=systolic),color="red") +
geom_point(aes(y=diastolic),color="black") +
facet_wrap(~hispanic)
dat %>%
ggplot(aes(x=visit)) +
geom_point(aes(y=systolic),color="red") +
geom_point(aes(y=diastolic),color="black") +
stat_summary(aes(y=systolic),geom="path", color="red") +
stat_summary(aes(y=diastolic),geom="path", color="black") +
labs(y="blood pressure") +
facet_wrap(~hispanic)
dat %>%
ggplot(aes(x=visit)) +
geom_point(aes(y=systolic),color="red") +
geom_point(aes(y=diastolic),color="black") +
stat_summary(aes(y=systolic),geom="path", color="red") +
stat_summary(aes(y=diastolic),geom="path", color="black") +
labs(y="blood pressure") +
facet_wrap(~sex)
dat %>%
ggplot(aes(x=visit)) +
geom_point(aes(y=systolic),color="red") +
geom_point(aes(y=diastolic),color="black") +
stat_summary(aes(y=systolic),geom="path", color="red") +
stat_summary(aes(y=diastolic),geom="path", color="black") +
labs(y="blood pressure") +
facet_wrap(~race)
library(tidyverse)
library(janitor)
library(readxl)
path <- "./Data/Messy_bp.xlsx"
# the data starts lower so we're not going to see column names
# data starts on A4 and ends on M24
# range lets you fix what is shown
df <- read_xlsx(path, range = "A4:M24") %>% clean_names()
# this can be used later to get the names of the visits
# visits <- read_xlsx(path, skip = 2,n_max = 0) %>% names()
# we want to pivot all the blood pressures together
# df <-
# df %>% pivot_longer(starts_with("bp_"), values_to =) %>%
#   mutate(visit = case_when(name == "bp_8" ~ 1,
#                            name == "bp_10" ~ 2,
#                            name == "bp_12" ~ 3)) %>%
#   pivot_longer(starts_with("hr_"),
#                names_to = "visit2",
#                values_to = "heart_rate")
# make a data frame with just the bp values
bp <-
df %>%
select(-starts_with("hr_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("bp_"), values_to ="bp") %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
select(-name) %>%
separate(bp, into = c("systolic","diastolic"), convert = TRUE)
# make data frame with just the hr values
hr <-
df %>%
select(-starts_with("bp_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("hr_"), values_to ="hr") %>%
mutate(visit = case_when(name == "hr_9" ~ 1,
name == "hr_11" ~ 2,
name == "hr_13" ~ 3)) %>%
select(-name)
# now join the two data frames
dat <-
full_join(bp,hr)
# add a date data type column *referene posix ct -> y-m-d
dat <-
dat %>%
mutate(birthdate = paste(year_birth,
month_of_birth,
day_birth,
sep = "-") %>%
as.POSIXct())
dat$race
dat %>%
mutate(race = case_when(race == "WHITE" ~ "White",
race == "caucasion" ~ "White"))
dat$race
dat %>%
mutate(race = case_when(race == "WHITE" ~ "White",
race == "caucasion" ~ "White"))
dat %>%
mutate(race = case_when(race == "WHITE" ~ "White",
race == "caucasion" ~ "White",
TRUE ~ race))
dat <-
dat %>%
mutate(race = case_when(race == "WHITE" ~ "White",
race == "caucasion" ~ "White",
TRUE ~ race))
dat$race
dat <-
dat %>%
mutate(race = case_when(race == "WHITE" ~ "White",
race == "Caucasian" ~ "White",
TRUE ~ race))
dat$race
saveRDS(dat,"./notes/cleaned_bp.rds")
library(tidyverse)
library(janitor)
library(readxl)
path <- "./Data/Messy_bp.xlsx"
# the data starts lower so we're not going to see column names
# data starts on A4 and ends on M24
# range lets you fix what is shown
df <- read_xlsx(path, range = "A4:M24") %>% clean_names()
# this can be used later to get the names of the visits
# visits <- read_xlsx(path, skip = 2,n_max = 0) %>% names()
# we want to pivot all the blood pressures together
# df <-
# df %>% pivot_longer(starts_with("bp_"), values_to =) %>%
#   mutate(visit = case_when(name == "bp_8" ~ 1,
#                            name == "bp_10" ~ 2,
#                            name == "bp_12" ~ 3)) %>%
#   pivot_longer(starts_with("hr_"),
#                names_to = "visit2",
#                values_to = "heart_rate")
# make a data frame with just the bp values
bp <-
df %>%
select(-starts_with("hr_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("bp_"), values_to ="bp") %>%
mutate(visit = case_when(name == "bp_8" ~ 1,
name == "bp_10" ~ 2,
name == "bp_12" ~ 3)) %>%
select(-name) %>%
separate(bp, into = c("systolic","diastolic"), convert = TRUE)
# make data frame with just the hr values
hr <-
df %>%
select(-starts_with("bp_")) %>% # for picking columns
# keeping everything except the heart rate ones
pivot_longer(starts_with("hr_"), values_to ="hr") %>%
mutate(visit = case_when(name == "hr_9" ~ 1,
name == "hr_11" ~ 2,
name == "hr_13" ~ 3)) %>%
select(-name)
# now join the two data frames
dat <-
full_join(bp,hr)
# add a date data type column *referene posix ct -> y-m-d
dat <-
dat %>%
mutate(birthdate = paste(year_birth,
month_of_birth,
day_birth,
sep = "-") %>%
as.POSIXct())
dat <-
dat %>%
mutate(race = case_when(race == "WHITE" ~ "White",
race == "Caucasian" ~ "White",
TRUE ~ race))
dat$race
saveRDS(dat,"./notes/cleaned_bp.rds")
dat %>%
ggplot(aes(x=visit)) +
geom_point(aes(y=systolic),color="red") +
geom_point(aes(y=diastolic),color="black") +
stat_summary(aes(y=systolic),geom="path", color="red") +
stat_summary(aes(y=diastolic),geom="path", color="black") +
labs(y="blood pressure") +
facet_wrap(~race)
library(tidyverse)
library(GGally)
dat <- readRDS("./notes/cleaned_bp.rds")
names(dat)
# part of (GGally), gets an initial look at the data
dat %>%
select(-c(pat_id, month_of_birth, day_birth, year_birth)) %>%
ggpairs()
dat %>%
ggplot(aes(x=visit)) +
geom_point(aes(y=systolic),color="red") +
geom_point(aes(y=diastolic),color="black") +
stat_summary(aes(y=systolic),geom="path", color="red") +
stat_summary(aes(y=diastolic),geom="path", color="black") +
labs(y="blood pressure") +
facet_wrap(~race)
dat %>%
group_by(race) %>%
summarize(mean_systolic = mean(systolic))
dat %>%
group_by(race,sex) %>%
summarize(mean_systolic = mean(systolic))
